<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title> Valentine's Packages</title>

  <!-- Font & Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-p8fXwXg6X0wq2b1vKxQk3y2p9CwqQxZl3s2s8xYQ7Kqg0q2QY2KxqQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />

  <!-- Paystack & jsPDF (for receipt generation) -->
  <script src="https://js.paystack.co/v1/inline.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <!-- Google Fonts: Raleway & Open Sans -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@400;700&family=Open+Sans&display=swap" rel="stylesheet" />
  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <!-- Animate.css for animations -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
 
 <style>


  :root{
    /* Color palette (light mode) */
    --bg: #fffefc;
    --muted-bg: #fff7f9;
    --surface: #ffffff;
    --card: #fff;
    --text: #1f1f23;
    --muted: #6b6b73;
    --accent: #ff3860;      /* warm valentine pink */
    --accent-2: #ff7aa2;    /* softer pink */
    --accent-contrast: #ffffff;
    --glass: rgba(255, 255, 255, 0.7);
    --outline: rgba(31,31,35,0.08);
    --shadow-sm: 0 6px 20px rgba(31,31,35,0.08);
    --shadow-lg: 0 18px 60px rgba(31,31,35,0.12);
    --success: #0bb27a;
    --radius-lg: 16px;
    --radius-md: 12px;
    --radius-sm: 8px;
    --max-width: 1200px;
    --container-pad: 18px;
    --glass-border: rgba(255,122,162,0.12);
  }

  /* Reset & base */
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:Inter, Poppins, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; background:linear-gradient(180deg,var(--muted-bg),var(--bg)); color:var(--text); -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale}
  img{max-width:100%;height:auto;display:block}
  a{color:inherit}
  small{font-size:12px;color:var(--muted)}
  button{font-family:inherit}

  /* Layout container */
  header, main, footer{max-width:var(--max-width);margin:0 auto;padding-left:var(--container-pad);padding-right:var(--container-pad)}
  header{display:flex;align-items:center;justify-content:space-between;padding-top:18px;padding-bottom:18px}
  .brand{display:flex;gap:14px;align-items:center}
  .logo{width:64px;height:64px;border-radius:50%;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:flex;align-items:center;justify-content:center;color:var(--accent-contrast);box-shadow:var(--shadow-lg);font-size:24px}
  .brand h1{margin:0;font-size:18px;letter-spacing:0.2px}
  .lead{margin:0;font-size:13px;color:var(--muted)}

  /* Top actions */
  .actions-top{display:flex;gap:10px;align-items:center}
  .outline{background:transparent;border:1px solid var(--outline);padding:10px 14px;border-radius:999px;color:var(--text);cursor:pointer;display:inline-flex;gap:8px;align-items:center}
  .outline:focus{outline:3px solid rgba(255,122,162,0.12);outline-offset:2px}

  /* HERO (mobile-first) */
  .hero{display:grid;gap:18px;padding-top:6px;padding-bottom:24px}
  .eyebrow{display:inline-flex;gap:8px;align-items:center;background:linear-gradient(90deg,var(--accent),var(--accent-2));padding:6px 10px;border-radius:999px;color:var(--accent-contrast);font-weight:700;font-size:12px;box-shadow:0 8px 24px rgba(255,122,162,0.12)}
  .headline{font-size:26px;line-height:1.05;margin:12px 0 6px 0;font-weight:700;color:var(--text)}
  .sub{color:var(--muted);margin:0 0 12px 0}

  /* Product grid/cards */
  .grid{display:grid;grid-template-columns:1fr;gap:12px}
  .card{
    background:var(--card);
    border:1px solid var(--outline);
    border-radius:var(--radius-lg);
    overflow:hidden;
    box-shadow:var(--shadow-sm);
    transition:transform .22s ease, box-shadow .22s ease;
    display:flex;flex-direction:column;
  }
  .card:hover{transform:translateY(-6px);box-shadow:var(--shadow-lg)}
  .product-media img{width:100%;height:180px;object-fit:cover}
  .card-body{padding:12px 14px;display:flex;flex-direction:column;gap:10px}
  .card-header{display:flex;align-items:center;justify-content:space-between;gap:12px}
  .card h3{margin:0;font-size:18px}
  .price-tag{display:inline-flex;align-items:center;gap:8px;background:linear-gradient(90deg,var(--accent),var(--accent-2));padding:6px 10px;border-radius:999px;color:var(--accent-contrast);font-weight:700;font-size:13px}
  .features{font-size:13px;color:var(--muted);margin:0}
  .choose{margin-top:auto;display:flex;justify-content:flex-end}
  .btn{background:var(--accent);border:none;color:var(--accent-contrast);padding:10px 14px;border-radius:12px;font-weight:700;cursor:pointer;display:inline-flex;gap:8px;align-items:center;box-shadow:0 10px 30px rgba(255,122,162,0.12);transition:transform .18s ease, box-shadow .18s ease}
  .btn:hover{transform:translateY(-3px);box-shadow:0 18px 40px rgba(255,122,162,0.14)}
  .btn:active{transform:translateY(-1px)}
  .btn.selected{box-shadow:0 22px 60px rgba(255,122,162,0.14)}

  /* Order box (right column on larger screens) */
  .order-box{
    background:linear-gradient(180deg,rgba(255,255,255,0.6),rgba(255,255,255,0.86));
    border:1px solid var(--outline);
    border-radius:18px;padding:14px;box-shadow:var(--shadow-sm);
    position:relative;
  }
  .order-box h4{margin:0 0 8px 0}
  .field{display:flex;flex-direction:column;margin-bottom:10px}
  label{font-size:13px;color:var(--muted);margin-bottom:6px}
  input[type="text"],input[type="number"],select,textarea,input[readonly]{
    background:transparent;border:1px solid var(--outline);padding:10px;border-radius:10px;color:var(--text);
    font-size:14px;
  }
  input:focus,select:focus,textarea:focus{outline:3px solid rgba(255,122,162,0.12);outline-offset:2px}
  textarea{resize:vertical;min-height:54px}

  .summary{background:linear-gradient(180deg,rgba(246,245,247,0.8),rgba(255,255,255,0.9));border-radius:10px;padding:12px;border:1px solid var(--glass-border)}
  .summary div{font-size:14px;color:var(--text)}
  .summary hr{border:none;border-top:1px solid rgba(0,0,0,0.05);margin:10px 0}

  /* Hearts decorative */
  .hearts{position:absolute;right:16px;top:16px;display:flex;gap:6px}
  .heart{width:12px;height:12px;border-radius:2px;background:var(--accent);transform:rotate(-45deg);box-shadow:0 8px 20px rgba(255,122,162,0.12);animation:slift 1.8s infinite}
  .heart:nth-child(2){animation-delay:0.25s}
  .heart:nth-child(3){animation-delay:0.5s}
  @keyframes slift{0%{transform:scale(.85) rotate(-45deg) translateY(0);opacity:1}50%{transform:scale(1.2) rotate(-45deg) translateY(-10px);opacity:0.9}100%{transform:scale(.9) rotate(-45deg) translateY(0);opacity:1}}

  /* Modal (desktop & mobile friendly) */
  .modal-backdrop{position:fixed;inset:0;background:rgba(31,31,35,0.35);display:flex;align-items:center;justify-content:center;z-index:9999;padding:18px}
  .modal{width:760px;max-width:100%;background:var(--surface);border-radius:12px;padding:18px;border:1px solid var(--outline);box-shadow:0 28px 80px rgba(31,31,35,0.12);color:var(--text)}
  .modal h3{margin:0 0 6px 0}
  .modal .actions{display:flex;gap:8px;justify-content:flex-end}
  .modal pre{white-space:pre-wrap;font-family:monospace}

  /* Toast */
  #slg-toast-container{font-weight:700}

  /* Responsive layout for larger screens */
  @media (min-width: 900px){
    .hero{grid-template-columns:1fr 420px;align-items:start;padding-top:30px;padding-bottom:40px;gap:28px}
    .grid{grid-template-columns:1fr;gap:14px}
    .product-media img{height:220px}
    header{padding-top:24px;padding-bottom:24px}
    .logo{width:72px;height:72px;font-size:28px}
  }

  /* Product grid multi-column on wide screens */
  @media (min-width: 1100px){
    .grid{grid-template-columns:repeat(2,1fr);gap:18px}
  }

  /* Tight mobile tweaks */
  @media (max-width:599px){
    .product-media img{height:160px}
    .headline{font-size:22px}
    .card-body{padding:10px}
    .order-box{padding:12px}
    .btn{padding:9px 12px;font-size:14px}
    .price-tag{font-size:12px;padding:6px 8px}
  }

  /* Very small screens: stack everything and make modal full-screen */
  @media (max-width:420px){
    .hero{gap:10px}
    .card{border-radius:12px}
    .modal{width:100%;height:100%;border-radius:0;overflow:auto}
    .modal-backdrop{align-items:flex-end}
  }

  /* Print styles: hide interactive controls */
  @media print{
    header, .order-actions, .btn, .outline, .hearts, #slg-toast-container, footer, .modal-backdrop{display:none !important}
    body{background:#fff}
  }

  /* Accessibility: focus visible for keyboard users */
  :focus{outline:3px solid rgba(255,122,162,0.14);outline-offset:2px}
   /* Contact modal (professional) */
.contact-modal-backdrop{
  position:fixed;
  inset:0;
  background:rgba(15,12,18,0.45);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:10050;
  padding:20px;
}
.contact-modal{
  width:460px;
  max-width:96%;
  background:linear-gradient(180deg,#ffffff,#fffafc);
  border-radius:14px;
  padding:18px;
  border:1px solid rgba(31,31,35,0.06);
  box-shadow:0 30px 80px rgba(31,31,35,0.12);
  color:var(--text);
  font-family:inherit;
}
.contact-modal-header{display:flex;align-items:center;justify-content:space-between;gap:12px}
.contact-brand{display:flex;gap:12px;align-items:center}
.contact-brand .logo{width:46px;height:46px;font-size:18px;border-radius:10px;box-shadow:var(--shadow-sm);display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,var(--accent),var(--accent-2));color:var(--accent-contrast)}
.contact-modal-header .muted{font-size:13px;color:var(--muted);margin-top:2px}
.contact-close, .contact-close:focus{background:transparent;border:0;color:var(--muted);font-size:18px;cursor:pointer;padding:6px;border-radius:8px}
.contact-close:hover{background:rgba(31,31,35,0.03);color:var(--text)}
.contact-body{margin-top:12px}
.contact-body .lead{margin:0 0 10px 0;color:var(--muted)}
.contact-list{list-style:none;padding:0;margin:0;display:flex;flex-direction:column;gap:8px}
.contact-list li{display:flex;align-items:center;gap:12px;padding:10px;border-radius:10px;border:1px solid rgba(31,31,35,0.04);background:linear-gradient(180deg,rgba(250,250,251,0.9),#fff)}
.contact-list a{display:flex;align-items:center;gap:12px;text-decoration:none;color:var(--text);width:100%}
.contact-list i{width:34px;height:34px;border-radius:8px;display:inline-flex;align-items:center;justify-content:center;font-size:16px}
.contact-list .fa-phone{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:var(--accent-contrast);padding:8px;border-radius:8px}
.contact-list .fa-whatsapp{color:#075E54;background:rgba(7,94,84,0.08);border-radius:8px;padding:8px}
.contact-list .fa-snapchat{color:#FFFC00;background:rgba(255,252,0,0.06);border-radius:8px;padding:8px}
.contact-footer{display:flex;justify-content:flex-end;margin-top:14px}
.contact-footer .btn{padding:10px 14px;border-radius:10px}

/* mobile tweak */
@media (max-width:420px){
  .contact-modal{width:100%;border-radius:12px;padding:14px}
  .contact-list li{padding:12px}
}
/* ---------- Styled inputs for Full name & Phone ---------- */
.styled-input {
  width:100%;
  background: transparent;
  border: 1px solid var(--outline);
  padding: 10px 12px;
  border-radius: 10px;
  color: var(--text);
  font-size: 14px;
  transition: box-shadow .18s ease, border-color .18s ease, transform .08s ease;
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;
}

/* placeholder & focus */
.styled-input::placeholder { color: rgba(31,31,35,0.35); }
.styled-input:focus {
  outline: none;
  box-shadow: 0 8px 30px rgba(255,122,162,0.10);
  border-color: rgba(255,122,162,0.32);
  transform: translateY(-1px);
}

/* optional input-with-icon wrapper for a neat look */
.input-row { display:flex; gap:10px; align-items:center; }
.input-icon {
  min-width:40px; height:40px; display:inline-flex; align-items:center; justify-content:center;
  border-radius:8px; font-size:16px;
  background: rgba(255,122,162,0.04);
  border: 1px solid rgba(31,31,35,0.03);
  color: var(--accent);
  flex-shrink:0;
}

/* ensure the input fields behave well in small screens */
@media (max-width:420px) {
  .input-row { gap:8px; }
  .input-icon { min-width:36px; height:36px; font-size:14px; }
}

   /* Toast: lighter, subtler & responsive */
#slg-toast-container{
  position:fixed;
  right:18px;
  bottom:18px;
  z-index:99999;
  display:flex;
  flex-direction:column;
  gap:8px;
  align-items:flex-end;
  font-weight:600;
  max-width:calc(100% - 40px);
  pointer-events:none; /* allow clicks to pass when not on toast */
}

.slg-toast {
  pointer-events:auto; /* allow interaction for dismiss button */
  width:auto;
  min-width:220px;
  max-width:360px;
  background: #ffffff;
  color: var(--text);
  border-radius:12px;
  border:1px solid rgba(31,31,35,0.06);
  padding:10px 12px;
  box-shadow: 0 10px 30px rgba(31,31,35,0.06);
  display:flex;
  gap:10px;
  align-items:center;
  font-size:14px;
  transform: translateY(8px);
  opacity:0;
  transition: transform 260ms cubic-bezier(.2,.9,.2,1), opacity 260ms ease;
}

/* subtle accent badge */
.slg-toast .badge {
  width:36px;height:36px;border-radius:8px;display:inline-flex;align-items:center;justify-content:center;
  background: linear-gradient(90deg,var(--accent),var(--accent-2));
  color:var(--accent-contrast);font-size:14px;flex-shrink:0;
}

/* message area */
.slg-toast .msg {flex:1;line-height:1.2}

/* dismiss button */
.slg-toast .dismiss {
  background:transparent;border:0;color:rgba(31,31,35,0.45);font-size:16px;padding:6px;border-radius:8px;cursor:pointer;
}
.slg-toast .dismiss:focus{outline:3px solid rgba(255,122,162,0.12);outline-offset:2px}

/* progress bar */
.slg-toast .progress {
  height:4px;background:rgba(31,31,35,0.06);border-radius:6px;margin-top:8px;overflow:hidden;
}
.slg-toast .progress > i {
  display:block;height:100%;width:100%;transform:translateX(-100%);
  background: linear-gradient(90deg,var(--accent),var(--accent-2));
  transition: transform linear;
}

/* show state */
.slg-toast.show { transform: translateY(0); opacity:1; }

/* reduce size on very small screens and center toasts */
@media (max-width:420px){
  #slg-toast-container{right:12px;left:12px;align-items:center}
  .slg-toast{max-width:100%;}
}
/* ---------------------------
   Payment success modal (professional & responsive)
   --------------------------- */
.modal-backdrop.payment-success{
  position:fixed;
  inset:0;
  background:rgba(10,11,13,0.48);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:10050;
  padding:18px;
}

.modal.payment-success{
  width:820px;
  max-width:100%;
  background:var(--surface);
  color:var(--text);
  border-radius:14px;
  padding:20px;
  border:1px solid rgba(31,31,35,0.06);
  box-shadow:0 40px 90px rgba(31,31,35,0.12);
  font-family:inherit;
  overflow:hidden;
}

/* Header */
.modal.payment-success .modal-header{
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
  gap:12px;
}
.modal.payment-success .modal-title{
  display:flex;
  gap:12px;
  align-items:center;
}
.modal.payment-success .modal-title h3{
  margin:0;font-size:18px;font-weight:800;
}
.modal.payment-success .modal-sub{font-size:13px;color:var(--muted);margin-top:2px}

/* header close */
.modal.payment-success .modal-close{
  background:transparent;border:0;color:var(--muted);font-size:18px;padding:8px;border-radius:8px;cursor:pointer;
}
.modal.payment-success .modal-close:focus{outline:3px solid rgba(255,122,162,0.12);outline-offset:3px}
.modal.payment-success .modal-close:hover{color:var(--text);background:rgba(31,31,35,0.03)}

/* Body: 2-column layout */
.modal.payment-success .modal-body{
  margin-top:14px;
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:18px;
  align-items:start;
}
.modal.payment-success .section-title{font-weight:700;margin:0 0 8px 0}
.modal.payment-success .kv{display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px solid rgba(31,31,35,0.03)}
.modal.payment-success .kv .label{color:var(--muted)}
.modal.payment-success .kv .value{font-weight:700}

/* Payment details small */
.modal.payment-success .small-note{font-size:13px;color:var(--muted);margin-top:8px}

/* Footer actions */
.modal.payment-success .modal-actions{
  margin-top:18px;
  display:flex;
  gap:10px;
  justify-content:flex-end;
  flex-wrap:wrap;
}

/* Primary & secondary button styles specifically for modal */
.modal.payment-success .btn.action-primary{
  background:linear-gradient(90deg,var(--accent),var(--accent-2));
  color:var(--accent-contrast);
  border:none;
  padding:10px 14px;border-radius:10px;font-weight:700;cursor:pointer;
  box-shadow:0 10px 30px rgba(255,122,162,0.10);
}
.modal.payment-success .btn.action-primary:focus{outline:3px solid rgba(255,122,162,0.12);outline-offset:2px}
.modal.payment-success .outline.action-secondary{
  background:transparent;border:1px solid rgba(31,31,35,0.08);color:var(--text);
  padding:10px 12px;border-radius:10px;font-weight:700;cursor:pointer;
}

/* Make code / references stand out */
.modal.payment-success code.ref{
  background:rgba(31,31,35,0.03);padding:6px 8px;border-radius:8px;font-weight:700;
  color:var(--accent);
  display:inline-block;
  margin-top:8px;
}

/* Responsive: single column & full screen on small devices */
@media (max-width:720px){
  .modal.payment-success{width:100%;border-radius:12px;padding:16px}
  .modal.payment-success .modal-body{grid-template-columns:1fr}
  .modal.payment-success .modal-actions{justify-content:stretch}
  .modal.payment-success .modal-actions .btn,
  .modal.payment-success .modal-actions .outline{flex:1 1 auto}
}

/* Very small screens ensure buttons visible and stacked nicely */
@media (max-width:420px){
  .modal-backdrop.payment-success{align-items:flex-end;padding:0}
  .modal.payment-success{border-radius:0;height:92vh;overflow:auto;padding:14px}
  .modal.payment-success .modal-actions{gap:8px}
}
/* ---------------------------
   Payment success modal (phone-perfect + safe-area)
   --------------------------- */

/* Backdrop */
.modal-backdrop.payment-success{
  position:fixed;
  inset:0;
  background:rgba(10,11,13,0.48);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:10050;

  /* Important: safe padding so iOS notch + browser bars don't cover modal */
  padding: max(14px, env(safe-area-inset-top))
           max(14px, env(safe-area-inset-right))
           max(14px, env(safe-area-inset-bottom))
           max(14px, env(safe-area-inset-left));
}

/* Modal shell */
.modal.payment-success{
  width:820px;
  max-width:100%;
  background:var(--surface);
  color:var(--text);
  border-radius:14px;
  padding:18px;
  border:1px solid rgba(31,31,35,0.06);
  box-shadow:0 40px 90px rgba(31,31,35,0.12);
  font-family:inherit;

  /* Key fix: never exceed the visible viewport (even with mobile browser UI) */
  max-height: calc(100svh - max(28px, env(safe-area-inset-top) + env(safe-area-inset-bottom)));
  overflow:hidden;

  /* Make header/body/actions behave properly */
  display:flex;
  flex-direction:column;
}

/* Header */
.modal.payment-success .modal-header{
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
  gap:12px;
  flex:0 0 auto;
}

.modal.payment-success .modal-title{
  display:flex;
  gap:12px;
  align-items:center;
  min-width:0;
}

.modal.payment-success .modal-title h3{
  margin:0;
  font-size:18px;
  font-weight:800;
}

.modal.payment-success .modal-sub{
  font-size:13px;
  color:var(--muted);
  margin-top:2px;
}

/* Close button */
.modal.payment-success .modal-close{
  background:transparent;
  border:0;
  color:var(--muted);
  font-size:18px;
  padding:8px;
  border-radius:8px;
  cursor:pointer;
}
.modal.payment-success .modal-close:hover{
  color:var(--text);
  background:rgba(31,31,35,0.03);
}
.modal.payment-success .modal-close:focus{
  outline:3px solid rgba(255,122,162,0.12);
  outline-offset:3px;
}

/* Body: scroll INSIDE modal (so nothing is hidden behind browser bars) */
.modal.payment-success .modal-body{
  margin-top:12px;
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:16px;
  align-items:start;

  overflow:auto;
  -webkit-overflow-scrolling:touch;
  padding-right:6px; /* space for scrollbar */
  flex:1 1 auto;
}

.modal.payment-success .section-title{
  font-weight:700;
  margin:0 0 8px 0;
}

.modal.payment-success .kv{
  display:flex;
  justify-content:space-between;
  gap:10px;
  padding:6px 0;
  border-bottom:1px solid rgba(31,31,35,0.03);
}
.modal.payment-success .kv .label{
  color:var(--muted);
}
.modal.payment-success .kv .value{
  font-weight:700;
  text-align:right;
  word-break:break-word;
}

.modal.payment-success .small-note{
  font-size:13px;
  color:var(--muted);
  margin-top:8px;
}

/* Code/reference styling */
.modal.payment-success code.ref{
  background:rgba(31,31,35,0.03);
  padding:6px 8px;
  border-radius:8px;
  font-weight:700;
  color:var(--accent);
  display:inline-block;
  max-width:100%;
  overflow-wrap:anywhere;
}

/* Actions: sticky so buttons are always visible on phones */
.modal.payment-success .modal-actions{
  margin-top:12px;
  display:flex;
  gap:10px;
  justify-content:flex-end;
  flex-wrap:wrap;

  flex:0 0 auto;
  position:sticky;
  bottom:0;
  background:linear-gradient(180deg, rgba(255,255,255,0.75), var(--surface));
  padding-top:10px;
  padding-bottom:max(10px, env(safe-area-inset-bottom));
  border-top:1px solid rgba(31,31,35,0.05);
}

/* Buttons in modal */
.modal.payment-success .btn.action-primary{
  background:linear-gradient(90deg,var(--accent),var(--accent-2));
  color:var(--accent-contrast);
  border:none;
  padding:10px 14px;
  border-radius:10px;
  font-weight:700;
  cursor:pointer;
  box-shadow:0 10px 30px rgba(255,122,162,0.10);
}
.modal.payment-success .btn.action-primary:focus{
  outline:3px solid rgba(255,122,162,0.12);
  outline-offset:2px;
}

.modal.payment-success .outline.action-secondary{
  background:transparent;
  border:1px solid rgba(31,31,35,0.08);
  color:var(--text);
  padding:10px 12px;
  border-radius:10px;
  font-weight:700;
  cursor:pointer;
}

/* Make header wrap cleanly on small screens */
@media (max-width:520px){
  .modal.payment-success .modal-header{
    flex-wrap:wrap;
  }
  .modal.payment-success .modal-close{
    margin-left:auto;
  }
}

/* Responsive: single column on small devices */
@media (max-width:720px){
  .modal.payment-success{
    width:100%;
    border-radius:12px;
    padding:14px;
  }
  .modal.payment-success .modal-body{
    grid-template-columns:1fr;
    gap:14px;
  }
  .modal.payment-success .modal-title h3{font-size:16px;}
  .modal.payment-success .modal-sub{font-size:12px;}

  .modal.payment-success .modal-actions{
    justify-content:stretch;
  }
  .modal.payment-success .modal-actions .btn,
  .modal.payment-success .modal-actions .outline{
    flex:1 1 auto;
  }
}

/* Very small screens: use dvh for mobile browser UI changes */
@media (max-width:420px){
  .modal.payment-success{
    max-height: calc(100dvh - max(28px, env(safe-area-inset-top) + env(safe-area-inset-bottom)));
  }
}

</style>

</head>
<body>
  <header>
    <div class="brand">
      <div class="logo"><i class="fa-solid fa-gift"></i></div>
      <div>
        <h1>BêllaBox</h1>
        <p class="lead">Moments, beautifully wrapped.</p>
      </div>
    </div>

    <div class="actions-top">
      <button class="outline" id="contactBtn"><i class="fa-solid fa-phone"></i> Contact</button>
    </div>
  </header>

  <main>
    <section class="hero" aria-label="Valentine's packages and order form">
      <!-- LEFT: products -->
      <div class="hero-left">
        <div class="eyebrow"><i class="fa-solid fa-heart"></i> LIMITED - Valentine Special</div>
        <h2 class="headline">Packages that say "I love you"...delivered with care</h2>
        <p class="sub">Choose a ready-made package or build a little box of joy. Fast pickup or delivery across town. Beautiful gift wrap included.</p>

        <div class="grid" role="list" aria-label="Package options">
          <!-- Full package -->
          <article class="card product-card" role="listitem" aria-labelledby="pkg-full-title" data-sku="full-package" data-price="350">
            <figure class="product-media" aria-hidden="false">
              <img src="full.jpg" alt="Full Valentine's package with drink, chocolate and sweets" />
            </figure>
            <div class="card-body">
              <div class="card-header" style="display:flex;justify-content:space-between;align-items:center">
                <h3 id="pkg-full-title">Full Package</h3>
                <span class="price-tag" aria-hidden="true"><i class="fa-solid fa-star"></i> GH₵ 350</span>
              </div>
              <p class="features">Includes: Welch's drink, premium chocolate, freshly-baked brownies, and curated foreign snacks.</p>
              <div class="choose">
                <button class="btn select-package" data-name="Full Package" data-price="350" aria-pressed="false">
                  <i class="fa-solid fa-gift" aria-hidden="true"></i> Choose
                </button>
              </div>
            </div>
          </article>

          <!-- Mud Cake -->
          <article class="card product-card" role="listitem" aria-labelledby="pkg-brownie-title" data-sku="brownies" data-price="300">
            <figure class="product-media">
              <img src="mud.jpg" alt="Close-up of decadent gooey mud cake" />
            </figure>
            <div class="card-body">
              <div class="card-header" style="display:flex;justify-content:space-between;align-items:center">
                <h3 id="pkg-brownie-title">Mud/Fudge Cake</h3>
                <span class="price-tag"><i class="fa-solid fa-brownie"></i> GH₵ 300</span>
              </div>
              <p class="features">Decadent, gooey mud cake....made fresh for Valentine's.</p>
              <div class="choose">
                <button class="btn select-package" data-name="Mud Cake/ Fudge Cake" data-price="300" aria-pressed="false">
                  <i class="fa-solid fa-check" aria-hidden="true"></i> Choose
                </button>
              </div>
            </div>
          </article>

          <!-- Chocolate -->
          <article class="card product-card" role="listitem" aria-labelledby="pkg-choco-title" data-sku="chocolate" data-price="250">
            <figure class="product-media">
              <img src="choc.jpg" alt="Assorted chocolates (Kingsbite, Kit Kat, Snickers, Cadbury Heroes)" />
            </figure>
            <div class="card-body">
              <div class="card-header" style="display:flex;justify-content:space-between;align-items:center">
                <h3 id="pkg-choco-title">Chocolate</h3>
                <span class="price-tag"><i class="fa-solid fa-chocolate"></i> GH₵ 250</span>
              </div>
              <p class="features">Pick from Kingsbite, Kit Kat, Snickers, or Cadbury Heroes.</p>
              <div class="choose">
                <button class="btn select-package" data-name="Chocolate" data-price="250" aria-pressed="false">
                  <i class="fa-solid fa-candy-cane" aria-hidden="true"></i> Choose
                </button>
              </div>
            </div>
          </article>
        </div>
      </div>

      <!-- RIGHT: order form -->
      <aside class="hero-right" aria-label="Order form">
        <div class="order-box" role="region" aria-labelledby="order-title">
          <div class="hearts" aria-hidden="true">
            <div class="heart"></div><div class="heart"></div><div class="heart"></div>
          </div>

          <h4 id="order-title"><i class="fa-solid fa-shopping-cart" aria-hidden="true"></i> Your Order</h4>

          <div class="field">
            <label for="packageSelect">Selected package</label>
            <input id="packageSelect" readonly value="No package chosen" aria-readonly="true" />
          </div>

          <div class="field">
            <label for="chocoOption">Chocolate option (if applicable)</label>
            <select id="chocoOption" aria-label="Choose chocolate flavor">
              <option value="">-- select --</option>
              <option>Kingsbite</option>
              <option>Kit Kat</option>
              <option>Snickers</option>
              <option>Cadbury Heroes</option>
            </select>
          </div>

          <div class="field">
            <label for="qty">Quantity</label>
            <input id="qty" type="number" min="1" value="1" aria-label="Quantity" />
          </div>

          <div class="field">
  <label for="name">Full name</label>
  <div class="input-row">
    <div class="input-icon" aria-hidden="true"><i class="fa-solid fa-user"></i></div>
    <input id="name" type="text" class="styled-input" placeholder="Recipient or buyer name" aria-required="true" />
  </div>
</div>

<div class="field">
  <label for="phone">Phone number</label>
  <div class="input-row">
    <div class="input-icon" aria-hidden="true"><i class="fa-solid fa-phone"></i></div>
    <input id="phone" type="tel" class="styled-input" placeholder="e.g. 024xxxxxxxx" aria-required="true" inputmode="tel" pattern="[0-9+\s()-]{7,}" />
  </div>
</div>
<div class="field">
  <label for="email">Email address</label>
  <div class="input-row">
    <div class="input-icon" aria-hidden="true"><i class="fa-solid fa-envelope"></i></div>
    <input
      id="email"
      type="email"
      class="styled-input"
      placeholder="e.g. bella@gmail.com"
      aria-required="true"
      autocomplete="email"
      inputmode="email"
      required
    />
  </div>
</div>


          <div class="field">
            <label for="address">Delivery address (or 'pickup')</label>
            <textarea id="address" rows="2" placeholder="Address or 'pickup'"></textarea>
          </div>

          <div class="field" aria-label="Delivery method">
            <label>Delivery method</label>
            <div class="delivery-options" role="radiogroup" aria-required="true">
              <label class="outline" for="method-delivery"><input id="method-delivery" type="radio" name="method" value="delivery" checked /> Delivery</label>
              <label class="outline" for="method-pickup"><input id="method-pickup" type="radio" name="method" value="pickup" /> Pickup</label>
            </div>
          </div>

          <div class="summary" aria-live="polite" aria-atomic="true">
            <div style="display:flex;justify-content:space-between">
              <div>Subtotal</div><div id="subtotal">GH₵ 0</div>
            </div>
            <div style="display:flex;justify-content:space-between;margin-top:6px">
              <div>Delivery</div><div id="deliveryCost">GH₵ 0</div>
            </div>
            <hr style="opacity:0.06;margin:10px 0" />
            <div style="display:flex;justify-content:space-between;font-weight:700">
              <div>Total</div><div id="total">GH₵ 0</div>
            </div>
          </div>

          <div class="order-actions" style="margin-top:14px;display:flex;gap:8px">
            <button class="btn" id="payBtn"><i class="fa-solid fa-credit-card" aria-hidden="true"></i> Pay with Paystack</button>
            <button class="outline" id="resetBtn"><i class="fa-solid fa-rotate" aria-hidden="true"></i> Reset</button>
          </div>

          <p class="note" style="font-size:12px;opacity:0.75;margin-top:12px">
            Secure payments via Paystack. 
          </p>
        </div>
      </aside>
    </section>
  </main>

  <!-- Modal root: scripts will inject modal content here -->
  <div id="modalRoot" aria-live="polite" style="display:none"></div>

  <footer>
    <small>Made with <i class="fa-solid fa-heart" style="color:var(--accent)"></i> BêllaBox</small>
  </footer>
</body>

  <script>
(() => {
  // ---------- Configuration ----------
  const config = {
    prices: { "Full Package": 350, "Brownies": 300, "Chocolate": 250 },
    paystackPublicKey: 'pk_live_dd07f23cf443b82c546aa66cd92a0aa3f5088ce2', // <-- Put your Paystack public key here
    currencySymbol: 'GH₵',
    processingRate: 0.0295, // 2.95%
    formspreeEndpoint: 'https://formspree.io/f/xrbyrqry'
  };

  // ---------- Helpers ----------
  const $ = (s) => document.querySelector(s);
  const $$ = (s) => Array.from(document.querySelectorAll(s));
  const el = (id) => document.getElementById(id);

  const formatCurrency = (n) => `${config.currencySymbol} ${Number(n).toFixed(2)}`;

  function isValidEmail(email) {
  const e = String(email || '').trim();
  // Simple & reliable email check (good enough for client-side)
  return /^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/i.test(e);
}

function showToast(message, opts = {}) {
  // opts: { duration: ms (number), type: 'info'|'success'|'error' } — type reserved for future use
  const DURATION_DEFAULT = typeof opts.duration === 'number' ? opts.duration : 2200; // 2200ms default

  // Ensure container
  let container = document.getElementById('slg-toast-container');
  if (!container) {
    container = document.createElement('div');
    container.id = 'slg-toast-container';
    document.body.appendChild(container);
  }

  // limit stacked to 3 toasts
  const existingToasts = container.querySelectorAll('.slg-toast');
  if (existingToasts.length >= 3) {
    // remove the oldest (bottom-most) gently
    const oldest = existingToasts[0];
    if (oldest) {
      oldest.classList.remove('show');
      setTimeout(() => { oldest.remove(); }, 260);
    }
  }

  // build toast
  const toast = document.createElement('div');
  toast.className = 'slg-toast';
  toast.setAttribute('role', 'status');
  toast.setAttribute('aria-live', 'polite');
  toast.innerHTML = `
    <div class="badge" aria-hidden="true"><i class="fa-solid fa-info"></i></div>
    <div class="msg">${escapeHtml(String(message))}</div>
    <button class="dismiss" aria-label="Dismiss notification"><i class="fa-solid fa-xmark"></i></button>
    <div style="width:100%"></div>
    <div class="progress" aria-hidden="true"><i></i></div>
  `;

  // append & animate in
  container.appendChild(toast);
  // allow CSS to apply
  requestAnimationFrame(() => { toast.classList.add('show'); });

  // wire dismiss
  const dismissBtn = toast.querySelector('.dismiss');
  dismissBtn.addEventListener('click', () => {
    clearTimers();
    toast.classList.remove('show');
    setTimeout(() => toast.remove(), 220);
  });

  // progress animation
  const progressBar = toast.querySelector('.progress > i');
  // Set transition duration dynamically so we can cancel/finish easily
  progressBar.style.transitionDuration = (DURATION_DEFAULT) + 'ms';
  // start the slide (translateX from -100% to 0)
  requestAnimationFrame(() => { progressBar.style.transform = 'translateX(0)'; });

  // auto-remove timer
  let removeTimer = setTimeout(() => {
    toast.classList.remove('show');
    setTimeout(() => toast.remove(), 260);
  }, DURATION_DEFAULT);

  // optional shorter fade-in small delay for accessibility
  let fadeInTimer = setTimeout(()=>{}, 0);

  function clearTimers() {
    clearTimeout(removeTimer);
    clearTimeout(fadeInTimer);
    // ensure progress stops
    progressBar.style.transitionDuration = '120ms';
  }

  // remove when user navigates away from page/visibility change
  function handleVisibility() {
    if (document.hidden) {
      clearTimers();
      toast.classList.remove('show');
      setTimeout(() => toast.remove(), 180);
      document.removeEventListener('visibilitychange', handleVisibility);
    }
  }
  document.addEventListener('visibilitychange', handleVisibility);

  // clean up after removal (safety in case DOM removed early)
  toast.addEventListener('remove', () => {
    clearTimers();
    document.removeEventListener('visibilitychange', handleVisibility);
  });

  return toast;
}


  function escapeHtml(s = '') {
    return String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
  }

  // ---------- State ----------
  const state = {
    name: null,
    price: 0,
    sku: null
  };

  // ---------- Elements ----------
  const packageSelectEl = el('packageSelect');
  const chocoOptionEl = el('chocoOption');
  const qtyEl = el('qty');
  const subtotalEl = el('subtotal');
  const deliveryCostEl = el('deliveryCost');
  const totalEl = el('total');
  const payBtn = el('payBtn');
  const resetBtn = el('resetBtn');
  const modalRoot = el('modalRoot');
  const contactBtn = el('contactBtn');
  const addressEl = el('address');
  const methodDeliveryEl = el('method-delivery');
  const methodPickupEl = el('method-pickup');

  // ---------- Initialization ----------
  function init() {
    // Save original innerHTML for each package button so we can restore it when deselected
    $$('.select-package').forEach(btn => {
      const name = btn.dataset.name || (btn.closest('.product-card') && btn.closest('.product-card').dataset.sku) || '';
      if (name === 'Brownies') {
        // Brownies original icon per user's request
        btn.dataset.origHtml = `<i class="fa-solid fa-cookie-bite" aria-hidden="true"></i> Choose`;
      } else {
        btn.dataset.origHtml = btn.innerHTML.trim();
      }
      btn.setAttribute('aria-pressed', 'false');
    });

    // wire package buttons (toggle/select)
    $$('.select-package').forEach(btn => {
      btn.addEventListener('click', () => {
        const name = btn.dataset.name || (btn.closest('.product-card') && btn.closest('.product-card').dataset.sku) || null;
        const price = Number(btn.dataset.price || (btn.closest('.product-card') && btn.closest('.product-card').dataset.price) || 0);
        const sku = (btn.closest('.product-card') && btn.closest('.product-card').dataset.sku) || (name && name.toLowerCase()) || null;
        if (!name) return;

        const alreadySelected = (state.sku && sku && state.sku === sku);

        if (alreadySelected) {
          // Deselect current
          deselectCurrentPackage();
          showToast(`${name} removed from selection`);
        } else {
          // Select this package (and deselect any previous)
          selectPackageButton(btn, { name, price, sku });
        }
      });
    });

    // qty update
    qtyEl.addEventListener('input', updateSummary);
    // delivery method change handlers
    $$('input[name="method"]').forEach(r => r.addEventListener('change', () => { handleMethodChange(); updateSummary(); }));

    // reset
    resetBtn.addEventListener('click', doReset);

    // pay
    payBtn.addEventListener('click', startPaystackPayment);

    // contact button (quick call)
   contactBtn?.addEventListener('click', () => { showContactModal(); });


    // set initial method behavior
    handleMethodChange();

    // initial summary compute
    updateSummary();

    // warn about missing libs
    if (typeof PaystackPop === 'undefined') {
      console.warn('Paystack inline script not found.');
      showToast('Paystack not loaded.', { duration: 6000 });
    }
    if (!window.jspdf) {
      console.warn('jsPDF not found.');
      showToast('jsPDF not loaded.', { duration: 6000 });
    }
  }

  // Contact modal (open/close)
function showContactModal() {
  const phone = '0205237411';
  const waPhone = '233205237411'; // wa.me needs country code (Ghana: 233) and no leading 0
  const snapchat = 'korkor_bella';

  modalRoot.innerHTML = `
    <div class="contact-modal-backdrop" id="contactModalBackdrop" role="dialog" aria-modal="true" aria-labelledby="contactModalTitle">
      <div class="contact-modal" role="document">
        <div class="contact-modal-header">
          <div class="contact-brand">
            <div class="logo"><i class="fa-solid fa-gift"></i></div>
            <div>
              <div style="font-weight:700">SweetLove Gifts</div>
              <div class="muted">Contact & support</div>
            </div>
          </div>
          <button class="contact-close" id="contactModalClose" aria-label="Close contact dialog"><i class="fa-solid fa-xmark"></i></button>
        </div>

        <div class="contact-body">
          <p class="lead">We’re happy to help. Reach us any time using the methods below.</p>
          <ul class="contact-list">
            <li><a href="tel:${phone}"><i class="fa-solid fa-phone"></i><span><strong>Call</strong><div style="font-size:13px;color:var(--muted)">${phone}</div></span></a></li>
            <li><a href="https://wa.me/${waPhone}" target="_blank" rel="noopener"><i class="fa-brands fa-whatsapp"></i><span><strong>WhatsApp</strong><div style="font-size:13px;color:var(--muted)">${phone}</div></span></a></li>
            <li><a href="https://www.snapchat.com/add/${snapchat}" target="_blank" rel="noopener"><i class="fa-brands fa-snapchat"></i><span><strong>Snapchat</strong><div style="font-size:13px;color:var(--muted)">@${snapchat}</div></span></a></li>
          </ul>
        </div>

        <div class="contact-footer">
          <button class="btn" id="contactModalCloseBtn">Close</button>
        </div>
      </div>
    </div>
  `;

  modalRoot.style.display = 'block';

  const backdrop = document.getElementById('contactModalBackdrop');
  const headerClose = document.getElementById('contactModalClose');
  const footerClose = document.getElementById('contactModalCloseBtn');

  // Focus management
  headerClose?.focus();

  function closeContactModal() {
    if (!modalRoot) return;
    modalRoot.innerHTML = '';
    modalRoot.style.display = 'none';
    contactBtn?.focus();
    document.removeEventListener('keydown', escHandler);
  }

  function backdropClick(e) {
    if (e.target && e.target.id === 'contactModalBackdrop') closeContactModal();
  }
  function escHandler(e) {
    if (e.key === 'Escape') closeContactModal();
  }

  backdrop?.addEventListener('click', backdropClick);
  headerClose?.addEventListener('click', closeContactModal);
  footerClose?.addEventListener('click', closeContactModal);
  document.addEventListener('keydown', escHandler);
}

  // ---------- Selection helpers ----------
  function selectPackageButton(btn, { name, price, sku }) {
    // Deselect previous if exists
    if (state.sku) {
      const prevBtn = $(`.select-package[aria-pressed="true"]`);
      if (prevBtn && prevBtn !== btn) restoreButtonToOriginal(prevBtn);
    }

    // Update state
    state.name = name;
    state.price = Number(price || 0);
    state.sku = sku;

    // Update button: show check + Selected
    btn.dataset.prevInner = btn.innerHTML;
    btn.innerHTML = `<i class="fa-solid fa-check" aria-hidden="true"></i> Selected`;
    btn.classList.add('selected');
    btn.setAttribute('aria-pressed', 'true');

    // Update the selected package input
    packageSelectEl.value = name;
    updateSummary();
    showToast(`${name} selected — ${formatCurrency(state.price)}`);
  }

  function restoreButtonToOriginal(btn) {
    const orig = btn.dataset.origHtml || btn.dataset.prevInner || btn.innerHTML;
    btn.innerHTML = orig;
    btn.classList.remove('selected');
    btn.setAttribute('aria-pressed', 'false');
  }

  function deselectCurrentPackage() {
    const prevBtn = $(`.select-package[aria-pressed="true"]`) || $$('.select-package').find(b => b.classList.contains('selected'));
    if (prevBtn) restoreButtonToOriginal(prevBtn);

    state.name = null;
    state.price = 0;
    state.sku = null;
    packageSelectEl.value = 'No package chosen';
    updateSummary();
  }

  // ---------- Address & delivery behavior (Task 2 preserved) ----------
  function handleMethodChange() {
    const method = document.querySelector('input[name="method"]:checked')?.value || 'delivery';
    if (method === 'pickup') {
      // Autofill pickup address, make read-only
      addressEl.value = 'UPSA hostel';
      addressEl.setAttribute('readonly', 'true');
      addressEl.setAttribute('aria-readonly', 'true');
      addressEl.placeholder = '';
      showSmallNote('Pickup selected. Pickup address set to UPSA hostel.');
    } else {
      // Delivery selected: enable address and prompt
      if (addressEl.value.trim() === 'UPSA hostel') addressEl.value = '';
      addressEl.removeAttribute('readonly');
      addressEl.removeAttribute('aria-readonly');
      addressEl.placeholder = "Enter delivery address. Delivery charges will be arranged after payment";
      showSmallNote('Delivery selected. Delivery charges will be communicated after payment.');
    }
  }

  function showSmallNote(text) {
    let note = document.querySelector('.delivery-note');
    if (!note) {
      note = document.createElement('div');
      note.className = 'delivery-note';
      note.style.fontSize = '12px';
      note.style.color = '#6b6b73';
      note.style.marginTop = '8px';
      note.style.opacity = '0.95';
      const summary = document.querySelector('.summary');
      if (summary) summary.appendChild(note);
    }
    note.textContent = text;
  }

  // ---------- Form helpers ----------
  function doReset() {
    state.name = null; state.price = 0; state.sku = null;
    packageSelectEl.value = 'No package chosen';
    chocoOptionEl.value = '';
    qtyEl.value = 1;
    el('name').value = ''; el('phone').value = ''; addressEl.value = '';
    $$('.select-package').forEach(b => { restoreButtonToOriginal(b); b.setAttribute('aria-pressed', 'false'); });
    // default to delivery (matches HTML) and update
    methodDeliveryEl.checked = true;
    handleMethodChange();
    updateSummary();
    showToast('Form reset');
  }
  // ---------- Send receipt to Formspree ----------
  async function sendToFormspree(data) {
    // If config.formspreeEndpoint is not set, skip gracefully
    if (!config.formspreeEndpoint || config.formspreeEndpoint.includes('yourFormId')) {
      console.warn('Formspree endpoint not configured.');
      return Promise.resolve(); // no-op
    }

    // Build a detailed payload with individual fields and full text
    const payload = {
      order_id: data.orderId || '',
      payment_reference: data.payRef || '',
      buyer_name: data.buyerName || '',
      buyer_email: data.buyerEmail || '',
      phone: data.phone || '',
      package: state.name || '',
      flavor: data.chosenChocolate || (state.name === 'Chocolate' ? 'N/A' : ''),
      quantity: String(data.q || ''),
      delivery_method: data.method || '',
      address: data.address || '',
      subtotal: typeof data.sub !== 'undefined' ? String(data.sub) : '',
      processing_fee: typeof data.processingFee !== 'undefined' ? String(data.processingFee) : '',
      delivery_label: data.deliveryLabel || '',
      total_charged: typeof data.totalCharged !== 'undefined' ? String(data.totalCharged) : '',
      timestamp: new Date().toISOString(),
      // include the full human-readable receipt as `message`
      message: receiptText(data)
    };

    try {
      const res = await fetch(config.formspreeEndpoint, {
        method: 'POST',
        headers: {
          'Accept': 'application/json',
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(payload),
        mode: 'cors'
      });

      if (!res.ok) {
        const text = await res.text().catch(()=>'');
        console.warn('Formspree response not ok', res.status, text);
        throw new Error('Formspree submission failed');
      }

      // Optional: give a small confirmation to the user
      showToast('Order data submitted to Formspree', { duration: 3000 });
      return res.json().catch(()=>({ ok:true }));
    } catch (err) {
      console.warn('Failed to send to Formspree:', err);
      showToast('Could not send order to Formspree (check config).', { duration: 4000 });
      return Promise.resolve();
    }
  }

  function ensureProcessingRowExists() {
    // create processing fee row (id=processingFeeRow) between delivery row and hr if not exists
    const summary = document.querySelector('.summary');
    if (!summary) return;
    if (!document.getElementById('processingFeeRow')) {
      // create wrapper
      const row = document.createElement('div');
      row.id = 'processingFeeRow';
      row.style.display = 'flex';
      row.style.justifyContent = 'space-between';
      row.style.marginTop = '6px';
      row.innerHTML = `<div>Processing fee</div><div id="processingFee">${formatCurrency(0)}</div>`;
      // find hr and insert row before hr
      const hr = summary.querySelector('hr');
      if (hr) summary.insertBefore(row, hr);
      else summary.appendChild(row);
    }
  }

  function updateSummary() {
    ensureProcessingRowExists();

    const q = Math.max(1, parseInt(qtyEl.value || 1));
    const sub = (state.price || 0) * q;
    const method = document.querySelector('input[name="method"]:checked')?.value || 'delivery';

    let deliveryLabel;
    if (method === 'pickup') {
      deliveryLabel = formatCurrency(0);
    } else {
      deliveryLabel = 'To be arranged';
    }

    // processing fee = 2.95% of subtotal (rounded to 2 decimals)
    const processingFeeRaw = sub * config.processingRate;
    const processingFee = Math.round(processingFeeRaw * 100) / 100;

    const totalCharged = Math.round((sub + processingFee) * 100) / 100;

    subtotalEl.textContent = formatCurrency(sub);
    deliveryCostEl.textContent = deliveryLabel;

    // set processing fee in DOM
    const feeEl = document.getElementById('processingFee');
    if (feeEl) feeEl.textContent = formatCurrency(processingFee);

    // total displayed is totalCharged (processing included)
    totalEl.textContent = formatCurrency(totalCharged);

    // store on state for later use in payment
    state._calc = { q, sub, processingFee, totalCharged, method };
  }

  // ---------- Payment flow (Task 3: processing fee included) ----------
  function startPaystackPayment() {
    // validation
    if (!state.name) { alert('Please choose a package first.'); return; }
    const buyerName = (el('name')?.value || '').trim();
    const phone = (el('phone')?.value || '').trim();
    const buyerEmail = (el('email')?.value || '').trim();
    let address = (addressEl?.value || '').trim();
    const method = document.querySelector('input[name="method"]:checked')?.value || 'delivery';

    if (!buyerName) { alert('Please enter a name.'); el('name').focus(); return; }
    if (!phone) { alert('Please enter a phone number.'); el('phone').focus(); return; }
   if (!buyerEmail) { alert('Please enter an email address.'); el('email').focus(); return; }
if (!isValidEmail(buyerEmail)) { alert('Please enter a valid email address (e.g. name@gmail.com).'); el('email').focus(); return; }
    if (state.name === 'Chocolate' && (!chocoOptionEl.value || chocoOptionEl.value === '')) {
      alert('Please choose a chocolate flavor for the Chocolate package.');
      chocoOptionEl.focus();
      return;
    }

    // enforce address rules
    if (method === 'pickup') {
      address = 'UPSA hostel';
    } else {
      if (!address) { alert('Please enter your delivery address. Delivery charges will be arranged after payment.'); addressEl.focus(); return; }
    }

    // Ensure summary calculations up-to-date
    updateSummary();
    const calc = state._calc || {};
    const sub = calc.sub || 0;
    const processingFee = calc.processingFee || 0;
    const totalToCharge = calc.totalCharged || sub + processingFee;

    // verify Paystack loaded and key configured
    if (typeof PaystackPop === 'undefined') {
      alert('Payment provider not loaded.');
      return;
    }
    if (!config.paystackPublicKey || config.paystackPublicKey.includes('REPLACE_WITH')) {
      alert('Paystack public key not configured.');
      return;
    }

    // Paystack expects amount in the smallest currency unit (pesewas). Multiply by 100.
    const amountInSmallest = Math.round(totalToCharge * 100);

    // Build metadata
    const metadata = {
      custom_fields: [
        { display_name: 'Phone', variable_name: 'phone', value: phone },
        { display_name: 'Package', variable_name: 'package', value: state.name },
        { display_name: 'Quantity', variable_name: 'quantity', value: calc.q || 1 },
        { display_name: 'Flavor', variable_name: 'flavor', value: (state.name === 'Chocolate' ? chocoOptionEl.value : 'N/A') },
        { display_name: 'Address', variable_name: 'address', value: address },
        { display_name: 'ProcessingFee', variable_name: 'processing_fee', value: processingFee },
        { display_name: 'DeliveryNote', variable_name: 'delivery_note', value: method === 'delivery' ? 'Delivery charges to be communicated after payment' : 'Pickup at UPSA hostel' }
      ]
    };

    const uniqueRef = `SLG-${Date.now()}-${Math.floor(Math.random()*90000+10000)}`;

    // open Paystack popup
    const handler = PaystackPop.setup({
      key: config.paystackPublicKey,
      email: buyerEmail,
      amount: amountInSmallest,
      currency: 'GHS',
      ref: uniqueRef,
      metadata,
      onClose: function() {
        showToast('Payment window closed');
      },
      callback: function(response) {
        // Prepare receipt data. include processingFee and totalCharged
        const receiptData = {
          orderId: uniqueRef,
          payRef: response.reference || uniqueRef,
          buyerName,
          buyerEmail,
          phone,
          address,
          method,
          q: calc.q || 1,
          sub,
          processingFee,
          deliveryLabel: (method === 'pickup') ? 'Pickup: UPSA hostel' : 'To be arranged (we will contact you)',
          totalCharged: Math.round((sub + processingFee) * 100) / 100,
          chosenChocolate: chocoOptionEl.value || ''
        };
        // send to Formspree (best-effort) — don't block user flow
sendToFormspree(receiptData).catch(()=>{}); // we handle errors inside the function

// show UI immediately regardless of form submission result
showSuccessModal(receiptData);
showToast('Payment successful, receipt ready. Delivery charges will be arranged after payment if applicable.');
      }
    });

    handler.openIframe();
  }

// ---------- Payment success modal (professional replacement) ----------
function showSuccessModal(data) {
  // ensure existing modal cleared first
  modalRoot.innerHTML = `
    <div class="modal-backdrop payment-success" id="paymentSuccessBackdrop" role="dialog" aria-modal="true" aria-labelledby="paymentSuccessTitle">
      <div class="modal payment-success" role="document" aria-describedby="paymentSuccessDesc">
        <div class="modal-header">
          <div class="modal-title" id="paymentSuccessTitle">
            <div style="width:44px;height:44px;border-radius:10px;display:flex;align-items:center;justify-content:center;background:linear-gradient(90deg,var(--accent),var(--accent-2));color:var(--accent-contrast);font-size:20px">
              <i class="fa-solid fa-check"></i>
            </div>
            <div>
              <h3>Payment Successful</h3>
              <div class="modal-sub">Thank you <strong>${escapeHtml(data.buyerName || '')}</strong> — your order has been confirmed.</div>
            </div>
          </div>
          <div style="text-align:right">
            <div style="font-size:12px;color:var(--muted);margin-bottom:6px">Order reference</div>
            <div><code class="ref">${escapeHtml(data.payRef || data.orderId || '')}</code></div>
          </div>
          <button class="modal-close" id="closeModalBtnHeader" aria-label="Close dialog"><i class="fa-solid fa-xmark"></i></button>
        </div>

        <div class="modal-body" id="paymentSuccessDesc">
          <div>
            <h4 class="section-title">Order summary</h4>
            <div class="kv"><div class="label">Package</div><div class="value">${escapeHtml(state.name || 'N/A')}</div></div>
            ${state.name === 'Chocolate' ? `<div class="kv"><div class="label">Flavor</div><div class="value">${escapeHtml(data.chosenChocolate || 'N/A')}</div></div>` : ''}
            <div class="kv"><div class="label">Quantity</div><div class="value">${escapeHtml(String(data.q || 1))}</div></div>
            <div class="kv"><div class="label">Delivery method</div><div class="value">${escapeHtml(data.method || 'N/A')}</div></div>
            <div class="kv"><div class="label">Phone</div><div class="value">${escapeHtml(data.phone || '')}</div></div>
            <div class="kv"><div class="label">Email</div><div class="value">${escapeHtml(data.buyerEmail || '')}</div></div>
            <div class="kv"><div class="label">Address</div><div class="value">${escapeHtml(data.address || '')}</div></div>
            <div class="small-note">We will contact you about delivery charges if applicable.</div>
          </div>

          <div>
            <h4 class="section-title">Payment</h4>
            <div class="kv"><div class="label">Subtotal</div><div class="value">${formatCurrency(data.sub || 0)}</div></div>
            <div class="kv"><div class="label">Processing fee</div><div class="value">${formatCurrency(data.processingFee || 0)}</div></div>
            <div class="kv"><div class="label">Delivery</div><div class="value">${escapeHtml(data.deliveryLabel || '')}</div></div>
            <div class="kv"><div class="label">Total charged</div><div class="value">${formatCurrency(data.totalCharged || 0)}</div></div>
            <div style="margin-top:10px;font-size:13px;color:var(--muted)">Payment ref: <code class="ref">${escapeHtml(data.payRef || '')}</code></div>
          </div>
        </div>

        <div class="modal-actions">
          <button class="btn action-primary" id="downloadPdfBtn"><i class="fa-solid fa-file-pdf" aria-hidden="true"></i>&nbsp;Download PDF</button>
          <button class="outline action-secondary" id="printBtn"><i class="fa-solid fa-print" aria-hidden="true"></i>&nbsp;Print</button>
          <button class="outline action-secondary" id="emailBtn"><i class="fa-solid fa-envelope" aria-hidden="true"></i>&nbsp;Email</button>
          <button class="outline action-secondary" id="copyBtn"><i class="fa-solid fa-copy" aria-hidden="true"></i>&nbsp;Copy</button>
          <button class="outline action-secondary" id="closeModalBtn"><i class="fa-solid fa-xmark" aria-hidden="true"></i>&nbsp;Close</button>
        </div>
      </div>
    </div>
  `;

  // show
  modalRoot.style.display = 'block';

  // grab elements
  const backdrop = document.getElementById('paymentSuccessBackdrop');
  const closeHeader = document.getElementById('closeModalBtnHeader');
  const closeFooter = document.getElementById('closeModalBtn');

  // hook buttons to existing helpers (these functions already exist in your script)
  const dlBtn = document.getElementById('downloadPdfBtn');
  const prBtn = document.getElementById('printBtn');
  const emBtn = document.getElementById('emailBtn');
  const cpBtn = document.getElementById('copyBtn');

  // add listeners (guard in case functions missing)
  dlBtn?.addEventListener('click', () => downloadPdfReceipt(data));
  prBtn?.addEventListener('click', () => printReceipt(data));
  emBtn?.addEventListener('click', () => emailReceipt(data));
  cpBtn?.addEventListener('click', () => copyReceiptToClipboard(data));

  // close helpers and cleanup
  function closeModal() {
    // remove listeners if any (safer)
    dlBtn?.replaceWith(dlBtn?.cloneNode(true));
    prBtn?.replaceWith(prBtn?.cloneNode(true));
    emBtn?.replaceWith(emBtn?.cloneNode(true));
    cpBtn?.replaceWith(cpBtn?.cloneNode(true));
    // hide and clear
    modalRoot.innerHTML = '';
    modalRoot.style.display = 'none';
    // return focus to Pay button so keyboard users continue smoothly
    payBtn?.focus();
    // remove key listener
    document.removeEventListener('keydown', escHandler);
  }

  function backdropClick(e) {
    if (e.target && e.target.id === 'paymentSuccessBackdrop') closeModal();
  }
  function escHandler(e) {
    if (e.key === 'Escape') closeModal();
  }

  backdrop?.addEventListener('click', backdropClick);
  closeHeader?.addEventListener('click', closeModal);
  closeFooter?.addEventListener('click', closeModal);
  document.addEventListener('keydown', escHandler);

  // accessibility: focus first actionable button
  (dlBtn || prBtn || emBtn || closeFooter)?.focus();
}


  function receiptText(data) {
    return [
      'SweetLove Gifts — Receipt',
      '----------------------------------------',
      `Order ID: ${data.orderId}`,
      `Payment reference: ${data.payRef}`,
      `Buyer: ${data.buyerName}`,
      `Phone: ${data.phone}`,
      `Email: ${data.buyerEmail || ''}`,
      `Package: ${state.name}`,
      `Flavor: ${state.name === 'Chocolate' ? (data.chosenChocolate || 'N/A') : 'N/A'}`,
      `Quantity: ${data.q}`,
      `Delivery method: ${data.method}`,
      `Address: ${data.address}`,
      '',
      `Subtotal: ${formatCurrency(data.sub)}`,
      `Processing fee: ${formatCurrency(data.processingFee)}`,
      `Delivery: ${data.deliveryLabel}`,
      `Total charged: ${formatCurrency(data.totalCharged)}`,
      '',
      'Note: Delivery charges (if any) will be communicated to you after payment.',
      '',
      'Thank you for choosing SweetLove Gifts!',
      'Contact us if you have any questions.'
    ].join('\n');
  }

  function copyReceiptToClipboard(data) {
    const text = receiptText(data);
    navigator.clipboard?.writeText(text).then(() => {
      showToast('Receipt copied to clipboard');
    }).catch(() => {
      alert('Could not copy receipt automatically. You can download the PDF instead.');
    });
  }

  function emailReceipt(data) {
    const subject = encodeURIComponent(`Your SweetLove Gifts receipt - ${data.orderId}`);
    const body = encodeURIComponent(receiptText(data));
    window.location.href = `mailto:?subject=${subject}&body=${body}`;
  }

function printReceipt(data) {
  // Build a stylish HTML receipt for printing — header intentionally does NOT include Order ID
  const html = `
    <!doctype html>
    <html>
      <head>
        <meta charset="utf-8">
        <title>Receipt - ${escapeHtml(data.orderId || '')}</title>
        <meta name="viewport" content="width=device-width,initial-scale=1">
        <style>
          :root{
            --accent:#ff3860;
            --accent-2:#ff7aa2;
            --muted:#6b6b73;
            --bg:#fff;
            --text:#111;
            --card:#ffffff;
          }
          html,body{margin:0;padding:0;font-family:Helvetica, Arial, sans-serif;color:var(--text);background:#fff}
          .page{width:100%;max-width:820px;margin:24px auto;padding:18px}
          .banner{
            background:linear-gradient(90deg,var(--accent),var(--accent-2));
            color:#fff;padding:18px;border-radius:10px;display:flex;align-items:center;justify-content:center;
            font-weight:800;font-size:18px;letter-spacing:0.6px;
          }
          .container{display:flex;gap:18px;margin-top:18px;flex-wrap:wrap}
          .box{flex:1;min-width:220px}
          .meta{background:rgba(0,0,0,0.02);padding:10px;border-radius:8px}
          .meta h4{margin:0 0 8px 0;font-size:13px}
          .kv{display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px solid rgba(0,0,0,0.04)}
          .items{margin-top:14px;border-radius:8px;overflow:hidden;border:1px solid rgba(0,0,0,0.06)}
          .items thead{background:rgba(0,0,0,0.03);font-weight:700}
          .items th,.items td{padding:10px 12px;text-align:left;font-size:13px}
          .items td.qty{width:60px;text-align:center}
          .totals{margin-top:12px;padding:12px;border-radius:8px;background:linear-gradient(180deg,rgba(255,255,255,0.98),#fff);border:1px solid rgba(0,0,0,0.04)}
          .totals .row{display:flex;justify-content:space-between;padding:6px 0}
          .totals .row.total{font-weight:800;font-size:15px;border-top:1px dashed rgba(0,0,0,0.06);padding-top:10px;margin-top:8px}
          .foot{margin-top:18px;font-size:12px;color:var(--muted)}
          code.ref{background:rgba(0,0,0,0.03);padding:6px 8px;border-radius:6px;color:var(--accent);font-weight:700}
          @media print{
            body{margin:0}
            .page{box-shadow:none;margin:0}
          }
        </style>
      </head>
      <body>
        <div class="page">
          <div class="banner">BêllaBox &nbsp;&nbsp;&nbsp;&nbsp; Receipt</div>

          <div class="container">
            <div class="box meta">
              <h4>Seller</h4>
              <div class="kv"><div>BêllaBox</div><div></div></div>
              <div class="kv"><div>Contact</div><div>0205237411</div></div>
              <div class="kv"><div>Website</div><div>SweetLove Gifts</div></div>
            </div>

            <div class="box meta">
              <h4>Customer</h4>
              <div class="kv"><div>Name</div><div>${escapeHtml(data.buyerName || '')}</div></div>
              <div class="kv"><div>Phone</div><div>${escapeHtml(data.phone || '')}</div></div>
             <div class="kv"><div>Email</div><div>${escapeHtml(data.buyerEmail || '')}</div></div>
              <div class="kv"><div>Order ID</div><div><code class="ref">${escapeHtml(data.orderId || '')}</code></div></div>
            </div>
          </div>

          <table class="items" width="100%" cellpadding="0" cellspacing="0" style="margin-top:18px;border-collapse:collapse">
            <thead>
              <tr>
                <th>Item</th>
                <th class="qty">Qty</th>
                <th>Unit</th>
                <th>Total</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>${escapeHtml(state.name || 'N/A')}${state.name==='Chocolate' ? ' — ' + escapeHtml(data.chosenChocolate || '') : ''}</td>
                <td class="qty">${escapeHtml(String(data.q || 1))}</td>
                <td>${escapeHtml(formatCurrency((data.sub || 0) / Math.max(1, (data.q || 1))))}</td>
                <td>${escapeHtml(formatCurrency(data.sub || 0))}</td>
              </tr>
            </tbody>
          </table>

          <div class="totals">
            <div class="row"><div>Subtotal</div><div>${escapeHtml(formatCurrency(data.sub || 0))}</div></div>
            <div class="row"><div>Processing fee</div><div>${escapeHtml(formatCurrency(data.processingFee || 0))}</div></div>
            <div class="row"><div>Delivery</div><div>${escapeHtml(data.deliveryLabel || '')}</div></div>
            <div class="row total"><div>Total charged</div><div>${escapeHtml(formatCurrency(data.totalCharged || 0))}</div></div>
          </div>

          <div class="foot">
            <div>Payment reference: <code class="ref">${escapeHtml(data.payRef || '')}</code></div>
            <div style="margin-top:8px">Note: Delivery charges (if any) will be communicated after payment. Thank you for choosing BêllaBox.</div>
          </div>
        </div>
      </body>
    </html>
  `;

  const w = window.open('', '_blank');
  w.document.write(html);
  w.document.close();
  w.focus();
  setTimeout(() => { w.print(); }, 400);
}

async function downloadPdfReceipt(data) {
  if (!window.jspdf || !window.jspdf.jsPDF) {
    alert('PDF generator not loaded.');
    return;
  }
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({ unit: 'pt', format: 'a4' });
  const left = 40;
  const pageWidth = doc.internal.pageSize.getWidth();
  let y = 40;

  // Accent banner across top with centered header text (Header must only be "SweetLove Gifts    Receipt")
  // Draw colored banner
  doc.setFillColor(255,56,96); // --accent
  doc.rect(0, 20, pageWidth, 44, 'F');
  // Header text (white)
  doc.setFontSize(18);
  doc.setTextColor(255,255,255);
  doc.setFont(undefined, 'bold');
  const header = 'SweetLove Gifts    Receipt';
  const headerX = pageWidth / 2;
  doc.text(header, headerX, 52, { align: 'center', baseline: 'middle' });

  // Body color
  doc.setTextColor(34,34,34);
  doc.setFontSize(10);
  doc.setFont(undefined, 'normal');

  // Seller & buyer block
  y = 84;
  const colGap = 12;
  const colW = (pageWidth - left*2 - colGap) / 2;

  // Seller box
  doc.setFillColor(250,250,250);
  doc.roundedRect(left, y, colW, 84, 6, 6, 'F');
  doc.setTextColor(80,80,80);
  doc.setFontSize(10);
  doc.text('Seller', left + 10, y + 16);
  doc.setFont(undefined, 'bold');
  doc.setTextColor(34,34,34);
  doc.text('SweetLove Gifts', left + 10, y + 34);
  doc.setFont(undefined, 'normal');
  doc.setTextColor(90,90,90);
  doc.text('Contact: 0205237411', left + 10, y + 50);

  // Buyer box
  const rightColX = left + colW + colGap;
  doc.setFillColor(250,250,250);
  doc.roundedRect(rightColX, y, colW, 84, 6, 6, 'F');
  doc.setTextColor(80,80,80);
  doc.text('Customer', rightColX + 10, y + 16);
  doc.setFont(undefined, 'bold');
  doc.setTextColor(34,34,34);
  doc.text(String(data.buyerName || ''), rightColX + 10, y + 34);
  doc.setFont(undefined, 'normal');
  doc.setTextColor(90,90,90);
  doc.text(`Phone: ${String(data.phone || '')}`, rightColX + 10, y + 50);
  doc.text(`Order ID: ${String(data.orderId || '')}`, rightColX + 10, y + 66);

  // Items table header
  y += 100;
  doc.setDrawColor(230,230,230);
  doc.setFillColor(245,245,245);
  doc.rect(left, y, pageWidth - left*2, 24, 'F');
  doc.setTextColor(60,60,60);
  doc.setFontSize(11);
  doc.text('Item', left + 10, y + 16);
  doc.text('Qty', left + 300, y + 16);
  doc.text('Unit', left + 360, y + 16);
  doc.text('Total', left + 440, y + 16);

  // Items row
  y += 28;
  doc.setFontSize(10);
  doc.setTextColor(40,40,40);
  const item = state.name || 'N/A';
  const flavorText = state.name === 'Chocolate' ? ` — ${data.chosenChocolate || 'N/A'}` : '';
  doc.text(`${item}${flavorText}`, left + 10, y + 12);
  const qty = String(data.q || 1);
  const unitPrice = ((data.sub || 0) / Math.max(1, (data.q || 1)));
  doc.text(qty, left + 300, y + 12);
  doc.text(formatCurrency(unitPrice), left + 360, y + 12);
  doc.text(formatCurrency(data.sub || 0), left + 440, y + 12);

  // Totals box
  y += 44;
  doc.setDrawColor(230,230,230);
  doc.setFillColor(255,255,255);
  doc.roundedRect(left, y, pageWidth - left*2, 110, 6, 6, 'S');
  let tx = left + (pageWidth - left*2) - 20;
  let labelX = left + (pageWidth - left*2) - 160;
  // Subtotal
  doc.setFontSize(10);
  doc.setTextColor(90,90,90);
  doc.text('Subtotal', labelX, y + 22, { align: 'left' });
  doc.setFont(undefined, 'bold');
  doc.text(formatCurrency(data.sub || 0), tx, y + 22, { align: 'right' });
  // Processing fee
  doc.setFont(undefined, 'normal');
  doc.setTextColor(90,90,90);
  doc.text('Processing fee', labelX, y + 44, { align: 'left' });
  doc.setFont(undefined, 'bold');
  doc.text(formatCurrency(data.processingFee || 0), tx, y + 44, { align: 'right' });
  // Delivery
  doc.setFont(undefined, 'normal');
  doc.setTextColor(90,90,90);
  doc.text('Delivery', labelX, y + 66, { align: 'left' });
  doc.setFont(undefined, 'bold');
  doc.text(String(data.deliveryLabel || ''), tx, y + 66, { align: 'right' });
  // Total (prominent)
  doc.setDrawColor(240,240,240);
  doc.setLineWidth(0.8);
  doc.line(labelX, y + 78, tx, y + 78);
  doc.setFontSize(12);
  doc.setFont(undefined, 'bold');
  doc.setTextColor(20,20,20);
  doc.text('Total charged', labelX, y + 100, { align: 'left' });
  doc.text(formatCurrency(data.totalCharged || 0), tx, y + 100, { align: 'right' });

  // Footer note
  y += 130;
  doc.setFontSize(9);
  doc.setTextColor(110,110,110);
  doc.text('Note: Delivery charges (if any) will be communicated to you after payment.', left, y);
  doc.setTextColor(255,56,96);
  doc.text('Thank you for ordering from SweetLove Gifts!', left, y + 16);

  // small decorative heart at top-right of banner
  doc.setFillColor(255,122,162);
  doc.text('♥', pageWidth - 50, 40);

  // Save
  const fname = `SweetLoveReceipt_${data.orderId || Date.now()}.pdf`;
  doc.save(fname);
  showToast('PDF receipt downloaded');
}



  // ---------- Kickoff ----------
  document.addEventListener('DOMContentLoaded', init);
})();
</script>


</html>
